/*
@Date: 2022/4/22 12:28
@Author: max.liu
@File : init_test_router
@Desc:
*/

package handler

import (
	"context"

	"github.com/gin-gonic/gin"
	"github.com/maxliu9403/common/apiserver"
	"github.com/maxliu9403/go-template/internal/config"
)

const (
	userHeader      = "_user"
	userHeaderValue = "eyJVc2VySWQiOjcwLCJBY2NvdW50SWQiOiJhZG1pbiIsIlVzZXJuYW1lIjoiYWRtaW4iLCJFbWFpbCI6IiIsIlBob25lIjoiIiwiU3RhdHVzIjowLCJTb3VyY2UiOjEsIkNyZWF0ZVRpbWUiOjE2MTU4NzI5Mzd9"
	orgHeader       = "_organizations"
	orgHeaderValue  = "W3siSWQiOjEsIlBhcmVudElkIjowLCJJc0N1cnJlbnRPcmdhbml6YXRpb24iOnRydWV9LHsiSWQiOjIsIlBhcmVudElkIjoxLCJJc0N1cnJlbnRPcmdhbml6YXRpb24iOnRydWV9LHsiSWQiOjMsIlBhcmVudElkIjoyLCJJc0N1cnJlbnRPcmdhbml6YXRpb24iOnRydWV9LHsiSWQiOjQsIlBhcmVudElkIjoyLCJJc0N1cnJlbnRPcmdhbml6YXRpb24iOmZhbHNlfSx7IklkIjoyODMsIlBhcmVudElkIjoyLCJJc0N1cnJlbnRPcmdhbml6YXRpb24iOmZhbHNlfSx7IklkIjoyODQsIlBhcmVudElkIjoyODMsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI4NSwiUGFyZW50SWQiOjI4NCwiSXNDdXJyZW50T3JnYW5pemF0aW9uIjpmYWxzZX0seyJJZCI6Mjg2LCJQYXJlbnRJZCI6Mjg1LCJJc0N1cnJlbnRPcmdhbml6YXRpb24iOmZhbHNlfSx7IklkIjoyODcsIlBhcmVudElkIjoyODYsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI4OCwiUGFyZW50SWQiOjI4NywiSXNDdXJyZW50T3JnYW5pemF0aW9uIjpmYWxzZX0seyJJZCI6Mjg5LCJQYXJlbnRJZCI6Mjg4LCJJc0N1cnJlbnRPcmdhbml6YXRpb24iOmZhbHNlfSx7IklkIjo5LCJQYXJlbnRJZCI6MSwiSXNDdXJyZW50T3JnYW5pemF0aW9uIjpmYWxzZX0seyJJZCI6MTAsIlBhcmVudElkIjo5LCJJc0N1cnJlbnRPcmdhbml6YXRpb24iOmZhbHNlfSx7IklkIjoxMiwiUGFyZW50SWQiOjksIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjE3LCJQYXJlbnRJZCI6MSwiSXNDdXJyZW50T3JnYW5pemF0aW9uIjpmYWxzZX0seyJJZCI6MTksIlBhcmVudElkIjoxNywiSXNDdXJyZW50T3JnYW5pemF0aW9uIjpmYWxzZX0seyJJZCI6MTgsIlBhcmVudElkIjoxLCJJc0N1cnJlbnRPcmdhbml6YXRpb24iOmZhbHNlfSx7IklkIjoyMCwiUGFyZW50SWQiOjE4LCJJc0N1cnJlbnRPcmdhbml6YXRpb24iOmZhbHNlfSx7IklkIjoyNSwiUGFyZW50SWQiOjE4LCJJc0N1cnJlbnRPcmdhbml6YXRpb24iOmZhbHNlfSx7IklkIjoyOCwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI0MSwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI0MiwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI0MywiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI0NCwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI0NSwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI0NiwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI0NywiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI0OCwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI0OSwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI1MCwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI1MSwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI1MiwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI1MywiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI1NCwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI1NSwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI1NiwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI1NywiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI1OCwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI1OSwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI2MCwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI2MSwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI2MiwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI2MywiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI2NCwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI2NSwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI2NiwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI2NywiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI2OCwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI2OSwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI3MCwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI3MSwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI3MiwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI3MywiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI3NCwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI3NSwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI3NiwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI3NywiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI3OCwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI3OSwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI4MCwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI4MSwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI4MiwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI5MCwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI5MSwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI5MiwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI5MywiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI5NCwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI5NSwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI5NiwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI5NywiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI5OCwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjI5OSwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjMwMCwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjMwMSwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjMwMiwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjMwMywiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjMwNCwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjMwNSwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjMwNiwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjMwNywiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjMwOCwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjMwOSwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjMxMCwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjMxMSwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjMxMiwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjMxMywiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjMxNCwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjMxNSwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjMxNiwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjMxNywiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjMxOCwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjMxOSwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjMyMCwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjMyMSwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjMyMiwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjMyMywiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjMyNCwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjMyNSwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjMyNiwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjMyNywiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjMyOCwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjMyOSwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjMzMCwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjMzMSwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjMzMiwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjMzMywiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjMzNCwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjMzNSwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjMzNiwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjMzNywiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjMzOCwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9LHsiSWQiOjMzOSwiUGFyZW50SWQiOjEsIklzQ3VycmVudE9yZ2FuaXphdGlvbiI6ZmFsc2V9XQ=="
)

func setupRouter() *gin.Engine {
	ctx, cancel := context.WithCancel(context.Background())
	defer cancel()

	config.G.App.RunMode = apiserver.RunModeRelease
	config.G.Log.Level = "debug"
	// config.G.MySQL.WriteDBHost = "127.0.0.1"
	// config.G.MySQL.WriteDBPort = 3306
	// config.G.MySQL.WriteDBUser = "root"
	// config.G.MySQL.WriteDBPassword = "root"
	// config.G.MySQL.WriteDB = "gorm"
	// config.G.MySQL.Prefix = "cmp_"
	// config.G.MySQL.Logging = true
	// config.G.MySQL.LogLevel = "info"

	s := apiserver.CreateNewServer(ctx, config.G.APIConfig)
	defer s.Stop()

	v1Group := s.AddGinGroup("")
	RegisterRouter(nil, v1Group)

	return s.ExposeEng()
}
